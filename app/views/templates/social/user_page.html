{% extends "base.html" %} 

{% block head%}
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    
.checked {
    color: orange;
}

#famous-books .description {
    height: 10.8em;
    overflow: hidden;
}

</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <img alt="avatar" width="100%" src="{{ user.add_avatar(1028) }}" class="img-fluid rounded">
            <p class="h3 font-weight-normal" style="margin-bottom:0px;">Foo Bar</p>
            <p class="text-muted">{{ user.username }}</p>
            {% if user.bio %}
            <p class="lead" id="text-bio">{{ user.bio }}</p>
            <button id="add_bio_button" type="button" class="btn btn-secondary btn-sm btn-block">Edit bio</button>
            {% elif current_user != user %}
            <button id="follow_button" type="button" class="btn btn-secondary btn-sm btn-block">Follow</button>
            {% elif current_user == user %}
            <p class="lead" id="text-bio" style="visibility: hidden;"></p>
            <button id="add_bio_button" type="button" class="btn btn-secondary btn-sm btn-block">Add a bio</button>
            {% endif %}
            <div class="form-group" id="add_bio_div" style="visibility: hidden; display:none;">
                <textarea placeholder="Type your bio here" id="add_bio_textarea" class="form-control" rows="5" id="comment"></textarea>
                <div style="margin-top: 10px;">
                    <button type="button" id="save_bio_button" class="btn btn-primary btn-sm">Save</button>
                    <button type="button" id="cancel_bio_button" class="btn btn-secondary btn-sm">Cancel</button>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <a style="text-decoration:none;color:inherit;" href="mailto:{{ user.email }}">
                    <i class="far fa-envelope lead"></i>
                </a>
                &ensp;&ensp;&ensp;
                <i class="far fa-comments lead"></i>
            </div>
            <hr>
        </div>
        <div class="col-sm-9">
            <p class="h2">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home"
                            aria-selected="true">
                            Overview
                        </a>
                        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile"
                            aria-selected="false">
                            Following
                        </a>
                        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact"
                            aria-selected="false">
                            Followers
                        </a>
                    </div>
                </nav>
                <div class="container">
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="famous-books" role="tabpanel" aria-labelledby="nav-home-tab">
                            <p class="lead" style="margin-bottom: 0px; margin-top: 15px;">Famous books</p>
                            <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <img class="img-fluid" src="https://books.google.com/books?id=zyTCAlFPjgYC&printsec=frontcover&img=1&zoom=6&edge=curl&source=gbs_api">
                                                <button type="button" class="btn btn-primary btn-sm btn-block">Get from Google</button>
                                            </div>
                                            <div class="col-sm-9">
                                                <div style="line-height: 0.9px;">
                                                    <p class="h4"><strong>The Google story</strong></p>
                                                    <p><small>by David A. Vise and Mark Malseed</small></p>
                                                    <div class="rating">
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star"></span>&ensp;
                                                        <span class="font-weight-light">128 reviews</span>
                                                    </div>
                                                </div>
                                                <div class="description">
                                                    Here is the story behind one of the most remarkable Internet
                                                    successes of our time. Based on scrupulous research and extraordinary access
                                                    to Google, ...
                                                    Here is the story behind one of the most remarkable Internet
                                                    successes of our time. Based on scrupulous research and extraordinary access
                                                    to Google, ...
                                                    Here is the story behind one of the most remarkable Internet
                                                    successes of our time. Based on scrupulous research and extraordinary access
                                                    to Google, ...
                                                    Here is the story behind one of the most remarkable Internet
                                                    successes of our time. Based on scrupulous research and extraordinary access
                                                    to Google, ...
                                                </div>
                                                <div id="read-more" class="text-center">
                                                    <a href="#" style="text-decoration:none;"><div>Read more</div></a>
                                                    <a href="#" style="font-size:10px;"><i class="fas fa-arrow-down"></i></a>
                                                </div>
                                                <div id="read-less" class="text-center">
                                                    <a href="#" style="text-decoration:none;"><div>Read down</div></a>
                                                    <a href="#" style="font-size:10px;"><i class="fas fa-arrow-up"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="carousel-item">
                                        First Page
                                    </div>
                                    <div class="carousel-item">
                                        Third Page
                                    </div>
                                </div>
                                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">...</div>
                        <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
                    </div>
                </div>
            </p>
        </div>
    </div>
</div>
{% endblock %} 
{% block script %}
<script>
    const username = "{{ user.username }}"

    // Add Bio section
    $("#add_bio_button").click(function () {
        $("#add_bio_button").fadeOut({
            "complete": () => {
                $("#add_bio_div").css("display", "block")
                $('#add_bio_div').css('visibility', 'visible').hide().fadeIn()
            }
        })
    })
    $("#cancel_bio_button").click(function () {

        $("#add_bio_div").fadeOut({
            "complete": () => {
                $('#add_bio_button').css('visibility', 'visible').hide().fadeIn()
                $("#add_bio_textarea").val("")
                $("#add_bio_div").css("display", "none")
            }
        })

    })

    $("#save_bio_button").click(function () {
        const bio = $("#add_bio_textarea").val()
        $.ajax({
            method: "POST",
            contentType: "application/json",
            url: Flask.url_for("social.add_bio", { "_external": true }),
            data: JSON.stringify({ username, bio })
        })
            .done(function (msg) {
                $("#text-bio").fadeOut({ "complete": () => $("#text-bio").text(bio) })

                $("#add_bio_div").fadeOut({
                    "complete": () => {
                        if (!bio) {
                            $('#add_bio_button').text("Add a bio")
                        }
                        else {
                            $('#add_bio_button').text("Edit bio")
                        }
                        $('#add_bio_button').css('visibility', 'visible').hide().fadeIn()
                        $('#text-bio').css('visibility', 'visible').hide().fadeIn()
                        $("#add_bio_textarea").val(bio)
                    }
                })
            })
            .fail(function (err) {
                $.ajax({
                    method: "POST",
                    contentType: "application/json",
                    url: Flask.url_for("api.flash_message", { "_external": true }),
                    data: JSON.stringify({ message: "Failed to update bio" })
                })
                    .done(function () {
                        window.location.replace(Flask.url_for("social.user", { username }))
                    })
            })
    })

</script> {% endblock %}